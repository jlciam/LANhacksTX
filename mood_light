/*
/* 
*  Adapted from the Grove Temperature Sensor, Fade, and Liquid LCD RGB backlight demos.
*  Sensor detects the environment temperature, connect the signal of this sensor to A0, 
*  and use Serial monitor to get the result.
*  
*/
#include <math.h>
#include <Wire.h>
#include "rgb_lcd.h"

//Initialize variables for temperature sensor
int a;
float temperature;
int B=3975;	//B value of thermistor
float resistance;

rgb_lcd lcd;

//LED Pin 13
//int led = 13;

//RGB color values
int colorR = 221;
int colorG = 160;
int colorB = 221;

const int TouchPin=9;
//const int ledPin=12;


void setup() {
	//TODO need to change this so we can display output to LCD
	Serial.begin(9600);

	
	pinMode(TouchPin, INPUT);
	//pinMode(lcd.,OUTPUT);

	// Initialize LED as output
	//pinMode(led,OUTPUT);

	// set up the LCD's number of columns and rows:
	lcd.begin(16, 2);
        lcd.setRGB(colorR, colorG, colorB);
} 
 

void loop() {
	//turn on the LED
	//digitalWrite(led, HIGH);   // turn the LED on (HIGH is the voltage level)
	//delay(1000);

	int sensorValue = digitalRead(TouchPin);	
	// set the cursor to column 0, line 0
	lcd.setCursor(0,0);
	if (sensorValue == 1) {
	    	lcd.print("Current temp is ");		
		lcd.setCursor(0, 1);
		lcd.print(temperature);	
		a=analogRead(0);
		resistance=(float)(1023-a)*10000/a; //get the resistance of the sensor;
		temperature=1/(log(resistance/10000)/B+1/298.15)-273.15;//convert to temperature via datasheet ;
		temperature = temperature * 9/5 + 32;	//Convert celsius to fahrenheit

		if (temperature <= 27.5) {	
			colorB += (0.55) * (27.5 - temperature);
			colorR -= (5.00) * (27.5 - temperature);
			colorG += (5.00) * (temperature - 27.5);
		} else if (temperature >= 27.5) {
			colorB -= (5.00) * (temperature - 27.5);
			colorR += (0.55) * (temperature - 27.5);
			colorG += (5.00) * (27.5 - temperature);
            }
		lcd.setRGB(colorR, colorG, colorB);
	} else {
		lcd.print("Please touch");
		lcd.setCursor(0,1);
		lcd.print("to see temp");
	}
	
	//digitalWrite(led, LOW);    // turn the LED off by making the voltage LOW
	//delay(1000);               // wait for a second
	delay(100);
}





